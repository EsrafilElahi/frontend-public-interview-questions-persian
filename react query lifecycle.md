# مستند جامع چهار حالت حیاتی در React Query

## حالت‌های اصلی چرخه حیات دیتا

### 1. حالت تازه (Fresh State)
**شرح**:  
داده در این حالت کاملاً معتبر و قابل اعتماد محسوب می‌شود. React Query در این حالت هیچ درخواست جدیدی به سرور ارسال نمی‌کند و از نسخه کش‌شده استفاده می‌کند.

**مکانیزم فعال‌سازی**:  
- پس از اولین دریافت موفق داده از سرور
- پس از هر بار refetch موفق

**مدت زمان بقا**:  
تا پایان مدت زمان تعیین شده در `staleTime` (پیش‌فرض: 0)

**موارد استفاده**:  
- برای داده‌هایی که تغییرات مکرر ندارند
- زمانی که می‌خواهید از درخواست‌های اضافی جلوگیری کنید

### 2. حالت منقضی (Stale State)
**شرح**:  
داده در این حالت ممکن است قدیمی باشد و نیاز به بررسی نسخه جدید از سرور دارد. React Query در شرایط خاص به صورت خودکار داده را مجدداً دریافت می‌کند.

**مکانیزم فعال‌سازی**:  
- بلافاصله پس از پایان `staleTime`
- پس از تغییر در query key

**رفتار سیستم**:  
- استفاده از داده کش‌شده برای نمایش اولیه
- ارسال درخواست جدید در پس‌زمینه در صورت وجود شرایط:
  - بازگشت به پنجره برنامه (refetchOnWindowFocus)
  - اتصال مجدد به اینترنت (refetchOnReconnect)
  - mount شدن مجدد کامپوننت

### 3. حالت غیرفعال (Inactive State)
**شرح**:  
داده در این حالت در حافظه کش وجود دارد، اما توسط هیچ کامپوننتی استفاده نمی‌شود. این حالت یک وضعیت موقتی قبل از حذف کامل داده است.

**مکانیزم فعال‌سازی**:  
- زمانی که تمام کامپوننت‌های استفاده‌کننده از query، unmount شوند

**مدت زمان بقا**:  
تا پایان مدت زمان تعیین شده در `gcTime` (پیش‌فرض: 5 دقیقه)

**مزایا**:  
- امکان بازیابی سریع داده بدون درخواست به سرور
- کاهش مصرف پهنای باند

### 4. حالت حذف شده (Deleted State)
**شرح**:  
داده کاملاً از حافظه کش پاک شده است و برای دسترسی مجدد نیاز به دریافت جدید از سرور دارد.

**مکانیزم فعال‌سازی**:  
- گذشت مدت زمان `gcTime` از آخرین استفاده
- حذف دستی با متد `removeQueries`
- پاک‌سازی کامل کش با `clear`

**اثرات**:  
- آزاد شدن حافظه
- نیاز به fetch جدید برای دسترسی مجدد

## نمودار انتقال بین حالت‌ها

```mermaid
stateDiagram-v2
  [*] --> Fresh: دریافت اولیه داده
  Fresh --> Stale: پایان staleTime
  Stale --> Fresh: دریافت موفق داده جدید
  Stale --> Inactive: عدم استفاده توسط کامپوننت‌ها
  Inactive --> Fresh: استفاده مجدد توسط کامپوننت
  Inactive --> Deleted: پایان gcTime
  Deleted --> [*]: حذف کامل